import{S as j,A as g,j as e}from"./sweetalert2.all.BzjA5z2z.js";import{r as u}from"./index.BVOCwoKb.js";async function T({form:n,validateForm:x,buildData:i,endpointUrl:f,redirectUrl:t,metodo:l,tipo:d="application/json"}){if(L(),!x()){await j.fire({text:"Por favor, complete los campos correctamente.",icon:"info"});return}try{const m=new FormData(n),p=i(m);let h;if(d==="application/json")h=await fetch(f,{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(p),credentials:"include"});else if(d==="multipart/form-data")h=await fetch(f,{method:l,body:i(m),credentials:"include"});else throw new Error("Tipo de contenido no soportado");const c=await h.json();c.status===201?(n.reset(),await j.fire({text:c.mensaje||"Formulario enviado correctamente",icon:"success"}),t&&(window.location.href=t)):c.status===200?(n.reset(),await j.fire({text:c.mensaje||"Porceso exitoso!",icon:"success"}),t&&(window.location.href=t)):c.errors?A(c.errors):await j.fire({text:c.mensaje||"Error desconocido",icon:"error"})}catch(m){await j.fire({text:"Error al conectar con el servidor",icon:"error"}),console.error(m)}}function L(){const n=document.querySelectorAll(".error-text");document.querySelectorAll(".error-input").forEach(i=>i.classList.remove("error-input")),n.forEach(i=>{i.textContent="",i.classList.add("hidden")})}function A(n){for(let x in n){const i=document.querySelector(`[name="${x}"]`),f=document.getElementById(`error-${x}`);i&&f&&(i.classList.add("error-input"),f.classList.remove("hidden"),f.textContent=n[x])}}const w=()=>crypto.randomUUID();function D(){const[n,x]=u.useState(!0),[i,f]=u.useState(null),[t,l]=u.useState({}),[d,m]=u.useState([]),[p,h]=u.useState([]),[c,N]=u.useState(null),I=u.useRef(null),v=u.useRef(null);u.useEffect(()=>{(async()=>{try{const s=await(await fetch(`${g}/api/candidatos/perfil`,{credentials:"include"})).json();l(s.candidato||{}),m((s.estudios||[]).map(a=>({...a,_tmpId:w()}))),h((s.historialLaboral||[]).map(a=>({...a,_tmpId:w()})))}catch{f("Error al obtener perfil")}finally{x(!1)}})()},[]);const $=r=>{const s=r.target.files[0];if(s){const a=URL.createObjectURL(s);N(a)}else N(null)},S=()=>m([...d,{_tmpId:w(),idEstudio:null,titulo:"",academia:"",idUsuario:t.idUsuario}]),k=r=>m(d.filter(s=>(s.idEstudio??s._tmpId)!==r)),C=(r,s,a)=>m(d.map(o=>(o.idEstudio??o._tmpId)===r?{...o,[s]:a}:o)),U=()=>h([...p,{_tmpId:w(),idHistorial:null,titulo:"",empresa:"",idUsuario:t.idUsuario}]),_=r=>h(p.filter(s=>(s.idHistorial??s._tmpId)!==r)),E=(r,s,a)=>h(p.map(o=>(o.idHistorial??o._tmpId)===r?{...o,[s]:a}:o)),H=async r=>{r.preventDefault();const s=d.map(({_tmpId:o,...b})=>b),a=p.map(({_tmpId:o,...b})=>b);try{const[o,b]=await Promise.all([fetch(`${g}/api/estudios/replace/${t.idUsuario}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"}),fetch(`${g}/api/historialLaborals/replace/${t.idUsuario}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"})]);if(!o.ok||!b.ok){const y=(o.ok?"":(await o.json().catch(()=>({}))).mensaje)||"",F=(b.ok?"":(await b.json().catch(()=>({}))).mensaje)||"";throw new Error(`${y} ${F}`.trim()||"Error al actualizar datos")}await T({form:r.target,validateForm:()=>!!t.nombre&&!!t.apellido&&!!t.correo&&!!v,buildData:y=>(y.set("candidato",new Blob([JSON.stringify({...t,idUsuario:t.idUsuario})],{type:"application/json"})),y),endpointUrl:`${g}/api/candidatos/edit/${t.idUsuario}`,redirectUrl:"/perfil/candidato",metodo:"PUT",tipo:"multipart/form-data"})}catch(o){console.error(o),await j.fire({icon:"error",text:o.message||"Ocurrió un error actualizando tu perfil"})}};return n?e.jsx("p",{className:"p-8 text-center",children:"Cargando…"}):i?e.jsx("p",{className:"p-8 text-center text-red-600",children:i}):e.jsx("div",{className:"mx-auto max-w-4xl p-4",children:e.jsxs("form",{onSubmit:H,encType:"multipart/form-data",className:"space-y-8 rounded-2xl bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col gap-6 md:flex-row md:items-center",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 md:w-1/3",children:[e.jsx("img",{src:c||(t.imagen?`${g}/img/${t.imagen}`:`${g}/images/imgCandidato.png`),alt:"avatar",className:"h-32 w-32 rounded-full object-cover shadow"}),e.jsxs("label",{className:"cursor-pointer text-sm font-medium text-primary-600 hover:underline",children:["Cambiar foto",e.jsx("input",{type:"file",name:"img",accept:"image/*",ref:I,className:"hidden",onChange:$})]}),e.jsx("p",{className:"error-text hidden",id:"error-imagen"})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[e.jsxs("div",{className:"flex flex-col w-full md:w-1/2",children:[e.jsx("label",{htmlFor:"nombre",className:"mb-1 text-sm font-medium",children:"Nombre"}),e.jsx("input",{id:"nombre",placeholder:"Nombre",name:"nombre",value:t.nombre||"",onChange:r=>l({...t,nombre:r.target.value}),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200 "}),e.jsx("p",{id:"error-nombre",className:"error-text hidden mt-1 text-xs text-red-500"})]}),e.jsxs("div",{className:"flex flex-col w-full md:w-1/2",children:[e.jsx("label",{htmlFor:"apellido",className:"mb-1 text-sm font-medium",children:"Apellido"}),e.jsx("input",{id:"apellido",placeholder:"Apellido",name:"apellido",value:t.apellido||"",onChange:r=>l({...t,apellido:r.target.value}),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200 "}),e.jsx("p",{id:"error-apellido",className:"error-text hidden mt-1 text-xs text-red-500"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center text-sm",children:[e.jsxs("label",{className:"inline-flex w-max cursor-pointer items-center gap-2 rounded-full bg-blue-500 px-4 py-2 font-medium text-white shadow hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),e.jsx("polyline",{points:"7 11 12 6 17 11"}),e.jsx("line",{x1:"12",y1:"6",x2:"12",y2:"18"})]}),t.curriculo?"Cambiar CV":"Subir CV",e.jsx("input",{type:"file",name:"pdf",accept:"application/pdf",ref:v,className:"hidden"})]}),t.curriculo&&e.jsxs("a",{href:`${g}/pdf/${t.curriculo}`,target:"_blank",rel:"noreferrer",className:"inline-flex w-max cursor-pointer items-center gap-2 rounded-full bg-blue-500 px-4 py-2 font-medium text-white shadow hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{d:"M12 5v14m7-7H5"})}),"Ver CV"]}),e.jsx("p",{id:"error-curriculo",className:"error-text hidden text-xs text-red-500"})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("label",{htmlFor:"correo",className:"mb-1 text-sm font-medium",children:"Correo electrónico"}),e.jsx("input",{id:"correo",type:"email",name:"correo",placeholder:"Correo electrónico",value:t.correo||"",onChange:r=>l({...t,correo:r.target.value}),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200 "}),e.jsx("p",{id:"error-correo",className:"error-text hidden mt-1 text-xs text-red-500"})]}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("label",{htmlFor:"telefono",className:"mb-1 text-sm font-medium",children:"Teléfono"}),e.jsx("input",{id:"telefono",name:"telefono",placeholder:"Teléfono",value:t.telefono||"",onChange:r=>l({...t,telefono:r.target.value}),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200 "}),e.jsx("p",{id:"error-telefono",className:"error-text hidden mt-1 text-xs text-red-500"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[e.jsxs("div",{className:"flex flex-col w-full md:w-1/2",children:[e.jsx("label",{className:"mb-1 text-sm font-medium",children:"Identificación"}),e.jsx("input",{type:"number",name:"identificacion",placeholder:"Identificación",value:t.identificacion||"",onChange:r=>l({...t,identificacion:r.target.value}),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200 "}),e.jsx("p",{id:"error-identificacion",className:"error-text mt-1 text-red-500 text-xs hidden"})]}),e.jsxs("div",{className:"flex flex-col w-full md:w-1/2",children:[e.jsx("label",{className:"mb-1 text-sm font-medium",children:"Años de experiencia laboral"}),e.jsx("input",{type:"number",min:"0",name:"experiencia",placeholder:"Años de experiencia",value:t.experiencia||"",onChange:r=>l({...t,experiencia:r.target.value}),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200 "}),e.jsx("p",{id:"error-experiencia",className:"error-text mt-1 text-red-500 text-xs hidden"})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"mb-2 text-lg font-semibold",children:"Descripción"}),e.jsx("textarea",{className:"h-32 w-full resize-none rounded-2xl border border-gray-300 p-4 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",placeholder:"Cuéntanos sobre ti, tus habilidades y experiencia…",value:t.descripcion||"",name:"descripcion",onChange:r=>l({...t,descripcion:r.target.value}),required:!0}),e.jsx("p",{className:"error-text hidden",id:"error-descripcion"})]}),e.jsxs("section",{children:[e.jsxs("header",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Estudios"}),e.jsx("button",{type:"button",onClick:S,className:"btn-primary inline-flex items-center gap-1 rounded-full px-4 py-2 text-sm",children:"+ Añadir"})]}),e.jsxs("div",{className:"space-y-4",children:[d.length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"No tienes estudios registrados."}),d.map(r=>{const s=r.idEstudio??r._tmpId;return e.jsxs("div",{className:"relative pl-8 before:absolute before:left-3 before:top-2 before:h-3 before:w-3 before:-translate-x-1/2 before:rounded-full before:bg-primary-500",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:`titulo-${s}`,className:"mb-1 text-sm font-medium",children:"Título"}),e.jsx("input",{id:`titulo-${s}`,placeholder:"Título",name:"titulo",value:r.titulo,onChange:a=>C(s,"titulo",a.target.value),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),e.jsx("p",{id:"error-titulo",className:"error-text hidden mt-1 text-xs text-red-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:`academia-${s}`,className:"mb-1 text-sm font-medium",children:"Institución"}),e.jsx("input",{id:`academia-${s}`,placeholder:"Institución",name:"academia",value:r.academia,onChange:a=>C(s,"academia",a.target.value),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),e.jsx("p",{id:"error-academia",className:"error-text hidden mt-1 text-xs text-red-500"})]})]}),e.jsx("button",{type:"button",onClick:()=>k(s),className:"mt-2 text-sm text-red-600 hover:underline",children:"Eliminar"})]},s)})]})]}),e.jsxs("section",{children:[e.jsxs("header",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Historial laboral"}),e.jsx("button",{type:"button",onClick:U,className:"btn-primary inline-flex items-center gap-1 rounded-full px-4 py-2 text-sm",children:"+ Añadir"})]}),e.jsxs("div",{className:"space-y-4",children:[p.length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"No tienes experiencia laboral registrada."}),p.map(r=>{const s=r.idHistorial??r._tmpId;return e.jsxs("div",{className:"relative pl-8 before:absolute before:left-3 before:top-2 before:h-3 before:w-3 before:-translate-x-1/2 before:rounded-full before:bg-primary-500",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1 text-sm font-medium",children:"Cargo"}),e.jsx("input",{placeholder:"Cargo",value:r.titulo,name:"titulo",onChange:a=>E(s,"titulo",a.target.value),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1 text-sm font-medium",children:"Empresa"}),e.jsx("input",{placeholder:"Empresa",value:r.empresa,onChange:a=>E(s,"empresa",a.target.value),className:"w-full rounded-2xl border border-gray-300 bg-white px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"})]})]}),e.jsx("button",{type:"button",onClick:()=>_(s),className:"mt-2 text-sm text-red-600 hover:underline",children:"Eliminar"})]},s)})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"submit",className:"rounded-full bg-blue-500 px-8 py-3 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Guardar"}),e.jsx("button",{type:"reset",onClick:()=>window.location.href="/perfil/candidato",className:"rounded-full bg-gray-400 px-8 py-3 text-white hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancelar"})]})]})})}export{D as default};
