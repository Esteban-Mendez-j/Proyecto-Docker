import{j as e,A as o,S as l}from"./sweetalert2.all.BzjA5z2z.js";import{r as n}from"./index.BVOCwoKb.js";import{m as h}from"./ManejarRespuesta.Bd8-Nm9C.js";import{P as B}from"./Paginacion.DN2WiRaF.js";const V=({vacanteId:p,itemsPerPage:C=10})=>{const[f,P]=n.useState([]),[i,d]=n.useState(1),[E,A]=n.useState(1),[S,b]=n.useState(!1),[g,R]=n.useState("ROLE_INVITADO"),[c,y]=n.useState({estado:"",fechaMinima:"",nombreCandidato:""}),[j,N]=n.useState({...c}),$=async()=>{try{const a=await fetch(`${o}/api/usuarios/rol`,{credentials:"include"}),t=await h(a);if(!t)return;R(t.rolPrincipal)}catch(a){console.error("Error fetching user role:",a)}},w=async(a=1)=>{b(!0);const{estado:t,fechaMinima:s,nombreCandidato:r}=j,M=new URLSearchParams({nvacantes:p,estado:t||"",fechaMinima:s||"",nombreCandidato:r||"",page:a-1,size:C});try{const m=await fetch(`${o}/api/postulados/lista?${M}`,{credentials:"include"}),u=await h(m);if(!u)return;P(u.postulados),A(u.totalPage)}catch(m){console.error("❌ Error al cargar postulados:",m)}finally{b(!1)}$()},k=()=>{N({...c}),d(1)},z=()=>{const a={estado:"",fechaMinima:"",nombreCandidato:""};y(a),N(a),d(1)},x=a=>{const{name:t,value:s}=a.target;y(r=>({...r,[t]:s}))};n.useEffect(()=>{w(i)},[p,i,j]);const T=async(a,t)=>{try{const s=await fetch(`${o}/api/chats/crear`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidatoId:a,vacanteId:t}),credentials:"include"}),r=await h(s);if(!r)return;window.location.href=`/chat/${r.id}`}catch(s){console.error("Error al abrir el chat:",s),await l.fire({text:"No se pudo abrir el chat.",icon:"info"})}},v=async(a,t)=>{const{isConfirmed:s}=await l.fire({title:"Confirmar acción",text:`¿Seguro que deseas marcar esta postulación como "${t}"?`,icon:"question",showCancelButton:!0,confirmButtonText:"Sí, continuar",cancelButtonText:"Cancelar",reverseButtons:!0});if(s)try{(await fetch(`${o}/api/postulados/edit/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({estado:t})})).ok||await l.fire({text:"Error al actualizar estado",icon:"error"}),alert(`Postulación ${t.toLowerCase()} correctamente`),w(i)}catch(r){console.error("Error al actualizar:",r),await l.fire({text:"Ocurrió un error al actualizar la postulación",icon:"error"})}};return e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-4 flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-semibold mb-1",children:"Estado:"}),e.jsxs("select",{name:"estado",onChange:x,value:c.estado,className:"border border-gray-300 rounded-md px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"Espera",children:"En Espera"}),e.jsx("option",{value:"Aceptada",children:"Aceptada"}),e.jsx("option",{value:"Rechazada",children:"Rechazada"}),e.jsx("option",{value:"Cancelada",children:"Canceladas"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-semibold mb-1",children:"Fecha mínima:"}),e.jsx("input",{type:"date",name:"fechaMinima",value:c.fechaMinima,onChange:x,className:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-semibold mb-1",children:"Nombre Candidato:"}),e.jsx("input",{type:"text",name:"nombreCandidato",value:c.nombreCandidato,onChange:x,className:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md",children:"Buscar"}),e.jsx("button",{onClick:z,className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md",children:"Borrar filtros"})]})]}),S?e.jsx("p",{className:"text-center text-gray-500 text-lg",children:"Cargando postulados..."}):f.length===0?e.jsxs("div",{className:"text-center p-6 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("p",{className:"text-yellow-700 font-medium text-lg",children:"No hay postulaciones registradas."}),e.jsx("p",{className:"text-yellow-600 text-sm",children:"Prueba ajustando los filtros o intenta más tarde."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 bg-white shadow-md rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-500 uppercase",children:"Nombre"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-500 uppercase",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-500 uppercase",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-500 uppercase",children:"CV"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-500 uppercase",children:"Perfil"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-500 uppercase",children:"Chat"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-500 uppercase",children:"Acción"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:f.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[a.candidato.nombre,!a.active&&e.jsx("span",{className:"block text-xs text-yellow-600 font-medium",children:"Postulación desactivada"}),!a.vacanteIsActive&&e.jsx("span",{className:"block text-xs text-red-600 font-medium",children:"Vacante deshabilitada"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.fechaPostulacion||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.estado||"Espera"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("a",{href:`${o}/pdf/${a.candidato.curriculo}`,target:"_blank",className:"text-blue-500 hover:underline font-medium",children:"Ver CV"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("a",{href:`/perfil/candidato/${a.candidato.id}?nPostulacion=${a.nPostulacion}`,className:"text-blue-500 hover:underline font-medium",children:"Ver perfil"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(a.estado==="Espera"||a.estado==="Aceptada")&&a.active&&a.vacanteIsActive&&g==="EMPRESA"&&e.jsx("button",{onClick:()=>T(a.candidato.id,a.vacante.id),className:"bg-blue-100 hover:bg-blue-200 text-blue-700 font-semibold py-1 px-3 rounded-md",children:"Abrir chat"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap space-y-2",children:a.estado==="Espera"&&a.active&&a.vacanteIsActive&&g==="EMPRESA"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"block w-full bg-red-100 hover:bg-red-200 text-red-700 font-semibold py-1 px-3 rounded-md",onClick:()=>v(a.nPostulacion,"Rechazada"),children:"Rechazar"}),e.jsx("button",{className:"block w-full bg-green-100 hover:bg-green-200 text-green-700 font-semibold py-1 px-3 rounded-md",onClick:()=>v(a.nPostulacion,"Aceptada"),children:"Aceptar"})]})})]},a.candidato.id))})]})}),e.jsx(B,{currentPage:i,setCurrentPage:d,totalPages:E})]})]})};export{V as default};
